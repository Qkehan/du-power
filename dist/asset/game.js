define("level/tutorial/Tutorial",function(require){function Tutorial(game,options){this.game=game,this.level=options.level,this.mask=null,this.group=null,this.init()}var global=require("common/global"),color=require("common/color"),Mask=require("common/ui/Mask"),proto=Tutorial.prototype;return proto.init=function(){this.initMask(),this.initGroup(),this.initGesture(),this.initCurrentInst(),this.initChargeInst(),this.show()},proto.initMask=function(){var me=this,mask=new Mask(this.game,{alpha:.5,onTouch:function(){me.destroy(),me.level.resume()}});this.mask=mask},proto.initGroup=function(){var group=this.game.add.group();group.fixedToCamera=!0,this.group=group},proto.initGesture=function(){var game=this.game,gesture=game.add.image(game.width/2,game.height,"gesture");gesture.anchor.set(.5,1),this.group.add(gesture);var inst=game.add.text(0,-200,"按住屏幕\n给小度向下的冲力",{font:"bold 42px "+global.fontFamily,fill:color.get("white")});inst.anchor.set(.5,1),gesture.addChild(inst)},proto.initCurrentInst=function(){var game=this.game,inst=game.add.text(game.width-20,game.height-16,"电流随时间而消耗",{font:"bold 30px "+global.fontFamily,fill:color.get("electric")});inst.anchor.set(1,1),this.group.add(inst);var arrow=game.add.image(-inst.width/2,-inst.height-10,"arrow-current");arrow.anchor.set(.5,1),arrow.scale.set(.7),arrow.angle-=45,inst.addChild(arrow)},proto.initChargeInst=function(){var game=this.game,inst=game.add.text(20,16,"飞到高处\n可以充电哦！",{font:"bold 30px "+global.fontFamily,fill:color.get("green")});this.group.add(inst);var arrow=game.add.image(inst.width,inst.height/2+20,"arrow-charge");arrow.anchor.set(0,1),arrow.scale.set(.7),inst.addChild(arrow)},proto.show=function(){this.mask.show(200),this.game.add.tween(this.group).from({alpha:0},200,Phaser.Easing.Quadratic.InOut).start()},proto.destroy=function(){this.mask.hide(200);var fadeOut=this.game.add.tween(this.group).to({alpha:0},200,Phaser.Easing.Quadratic.InOut);fadeOut.onComplete.add(function(){this.group.destroy()},this),fadeOut.start()},Tutorial}),define("level/scene/Flag",function(require){function Flag(game,options){this.game=game,this.sprite=null,this.group=null,this.x=options.x,this.y=options.y,this.animName="flutter",this.init()}var proto=Flag.prototype;return proto.init=function(){this.initSprite(),this.initGroup()},proto.initSprite=function(){var game=this.game,sprite=game.add.sprite(this.x,this.y,"flag");sprite.scale.set(.7),sprite.anchor.set(1,1),this.sprite=sprite;var animations=sprite.animations,animName=this.animName;animations.add(animName),animations.play(animName,6,!0)},proto.initGroup=function(){var group=this.game.add.group();group.addMultiple([this.sprite]),this.group=group},proto.pauseAnim=function(){this.sprite.animations.currentAnim.stop()},proto.resumeAnim=function(){this.sprite.animations.currentAnim.play()},Flag}),define("level/scene/Background",function(require){function Background(game,options){this.game=game,this.level=options.level,this.image=null,this.imageName=options.imageName,this.absSpeed=options.absSpeed||0,this.relSpeed=options.relSpeed||0,this.alpha="undefined"!==options.alpha?options.alpha:1,this.init()}return Background.prototype.init=function(){var game=this.game,imageName=this.imageName,imageCache=game.cache.getImage(imageName),image=game.add.tileSprite(0,game.height,imageCache.width,imageCache.height,imageName);image.alpha=this.alpha,image.anchor.set(0,1),image.fixedToCamera=!0,this.image=image},Background.prototype.show=function(duration){if(duration){var show=this.game.add.tween(this.image).to({alpha:1},duration),promise=new Promise(function(resolve){show.onComplete.add(resolve)});return show.start(),promise}return this.image.alpha=1,Promise.resolve()},Background.prototype.hide=function(duration){if(duration){var show=this.game.add.tween(this.image).to({alpha:0},duration),promise=new Promise(function(resolve){show.onComplete.add(resolve)});return show.start(),promise}return this.image.alpha=0,Promise.resolve()},Background.prototype.update=function(){var level=this.level;this.scroll(this.absSpeed+(this.game.camera.x/level.zoom.scale.x-level.lastCameraX)*this.relSpeed)},Background.prototype.scroll=function(offsetX){this.image.tilePosition.x-=offsetX},Background.prototype.destroy=function(){this.image.destroy()},Background}),define("level/play/Roadmap",function(require){function Roadmap(game,options){this.game=game,this.level=options.level,this.location=null,this.element=null,this.init()}var proto=Roadmap.prototype;return proto.init=function(){var game=this.game,location=game.add.image(0,game.height,"hero-label");location.anchor.set(0,1),location.scale.set(.9),this.location=location,this.element=location},proto.update=function(){this.location.x=this.level.progress*this.game.width},Roadmap}),define("level/play/PlayUI",function(require){function PlayUI(game,options){this.game=game,this.level=options.level,this.group=null,this.alarm=null,this.roadmap=null,this.pause=null,this.chargeTip=null,this.init()}var Alarm=require("./Alarm"),Roadmap=require("./Roadmap"),Pause=require("./Pause"),ChargeTip=require("./ChargeTip"),proto=PlayUI.prototype;return proto.init=function(){var game=this.game,level=this.level,group=game.add.group();group.fixedToCamera=!0,this.group=group;var alarm=new Alarm(game,{level:level});this.alarm=alarm,group.add(alarm.element);var roadmap=new Roadmap(game,{level:level});this.roadmap=roadmap,group.add(roadmap.element);var pause=new Pause(game,{level:level});this.pause=pause,group.add(pause.group);var chargeTip=new ChargeTip(game,{level:level});this.chargeTip=chargeTip,group.add(chargeTip.group)},proto.update=function(){this.alarm.update(),this.roadmap.update(),this.chargeTip.update()},proto.destroy=function(){var alarm=this.alarm;alarm.isAlarming&&alarm.recover(),this.group.destroy()},PlayUI}),define("level/play/Pause",function(require){function Pause(game,options){this.game=game,this.level=options.level,this.trigger=null,this.menu=null,this.group=null,this.isCollapsed=!0,this.init()}var color=require("common/color"),util=require("common/util"),Mask=require("common/ui/Mask"),proto=Pause.prototype;return proto.init=function(){this.initTrigger(),this.initMenu(),this.initGroup()},proto.initTrigger=function(){var game=this.game,trigger=game.add.button(game.width-40,24,"button-pause",function(){this.isCollapsed?(game.sound.play("click"),this.level.pause(),trigger.loadTexture("button-close"),this.isCollapsed=!1,this.menu.visible=!0):(game.sound.play("click"),this.level.resume(),trigger.loadTexture("button-pause"),this.isCollapsed=!0,this.menu.visible=!1)},this);trigger.anchor.set(1,0),trigger.inputEnabled=!0,util.addHover(trigger),this.trigger=trigger},proto.initMenu=function(){var game=this.game,menu=game.add.group();menu.visible=!1,this.menu=menu;var me=this,trigger=this.trigger,LEVEL_STATUS=this.level.STATUS,transition=function(){return new Mask(game,{color:color.get("black"),alpha:1}).show(150)};[{name:"button-back",onClick:function(){game.sound.play("click"),transition().then(function(){game.state.restart(!0,!1,LEVEL_STATUS.MENU)})}},{name:"button-restart",onClick:function(){game.sound.play("click"),transition().then(function(){game.state.restart(!0,!1,LEVEL_STATUS.PLAY)})}}].forEach(function(config,index){var btn=game.add.button(trigger.x,trigger.y+80*(index+1),config.name,config.onClick,me);btn.anchor.set(1,0),util.addHover(btn),menu.add(btn)})},proto.initGroup=function(){var group=this.game.add.group();group.addMultiple([this.trigger,this.menu]),this.group=group},Pause}),define("level/play/ChargeTip",function(require){function ChargeTip(game,options){this.game=game,this.level=options.level,this.group=null,this.init()}var proto=ChargeTip.prototype;return proto.init=function(){this.initGroup()},proto.initGroup=function(){this.group=this.game.add.group()},proto.addTip=function(name){var game=this.game,group=this.group,Easing=Phaser.Easing,oldTip=group.getTop();if(oldTip){var oldFadeOut=game.add.tween(oldTip).to({alpha:0},150,Easing.Quadratic.In);oldFadeOut.onComplete.add(function(){oldTip.destroy()}),oldFadeOut.start()}var tip=game.add.image(game.width/2,50,name);tip.anchor.set(.5,0),tip.scale.set(.5),group.add(tip);var flyIn=game.add.tween(tip).from({x:game.width+tip.width/2},300,Easing.Quadratic.Out),fadeOut=game.add.tween(tip).to({alpha:0},300,Easing.Quadratic.In,!1,400);fadeOut.onComplete.add(function(){tip.destroy()}),flyIn.chain(fadeOut),flyIn.start()},proto.update=function(){var level=this.level,sound=level.sound,power=level.power,STATUS=power.STATUS,lastStatus=power.lastStatus;switch(power.status){case STATUS.NORMAL_CHARGE:lastStatus===STATUS.LOSING&&(sound.play("charge"),this.addTip("charge"));break;case STATUS.SUPER_CHARGE:lastStatus===STATUS.NORMAL_CHARGE&&(sound.play("charge-double"),this.addTip("charge-double"))}},ChargeTip}),define("level/play/Alarm",function(require){function Alarm(game,options){this.game=game,this.level=options.level,this.image=null,this.element=null,this.isAlarming=!1,this.tween=null,this.audio=null,this.init()}var color=require("common/color"),proto=Alarm.prototype;return proto.init=function(){var game=this.game,bitmap=game.add.bitmapData(game.width,game.height);bitmap.rect(0,0,bitmap.width,bitmap.width,color.get("red"));var image=game.add.image(0,0,bitmap);image.visible=!1,image.alpha=.5,this.image=image,this.element=image},proto.update=function(){var power=this.level.power;!this.isAlarming&&power.isLow()?this.alarm():this.isAlarming&&!power.isLow()&&this.recover()},proto.alarm=function(){var game=this.game;this.image.visible=1,this.tween=game.add.tween(this.image).from({alpha:0},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).start(),this.audio=game.sound.play("alarm",1,!0),this.isAlarming=!0},proto.recover=function(){var image=this.image;image.visible=!1,image.alpha=.5,this.tween.stop(!0),this.audio.stop(),this.isAlarming=!1},Alarm}),define("level/menu/Title",function(require){function Title(game,options){this.game=game,this.wordart=null,this.decoration=null,this.element=null,this.init()}var proto=Title.prototype;return proto.init=function(){var game=this.game,wordart=game.add.image(game.width/2,90,"title");wordart.anchor.set(.5),wordart.scale.set(.6),this.wordart=wordart;var decoration=game.add.image(0,-18,"title-decoration");decoration.anchor.set(.5),wordart.addChild(decoration),this.decoration=decoration,this.element=wordart,this.animate()},proto.animate=function(){this.game.add.tween(this.decoration.scale).to({x:1.08,y:1.08},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},Title}),define("level/menu/Start",function(require){function Start(game,options){this.game=game,this.level=options.level,this.button=null,this.ring=null,this.element=null,this.init()}var util=require("common/util"),proto=Start.prototype;return proto.init=function(){var game=this.game,button=game.add.button(game.width/2,game.height/2,"start",function(){game.sound.play("click"),button.inputEnabled=!1,this.fadeOut(),this.level.initPlayStatus()},this);button.anchor.set(.5),this.button=button,util.addHover(button);var ring=game.add.image(0,0,"start-ring");ring.anchor.set(.5),button.addChild(ring),this.ring=ring,this.element=button,this.animate()},proto.animate=function(){this.game.add.tween(this.ring).to({angle:"+360"},3e3,Phaser.Easing.Linear.None,!0,0,-1)},proto.fadeOut=function(){},Start}),define("level/menu/Menu",function(require){function Menu(game,options){this.game=game,this.level=options.level,this.mask=null,this.group=null,this.init()}var global=require("common/global"),Mask=require("common/ui/Mask"),Start=require("./Start"),Title=require("./Title"),BtnTicket=require("./BtnTicket"),proto=Menu.prototype;return proto.init=function(){var game=this.game,level=this.level;this.mask=new Mask(game,{alpha:.4});var start=new Start(game,{level:level}),title=new Title(game),group=game.add.group();if(group.fixedToCamera=!0,group.addMultiple([start.element,title.element]),this.group=group,global.getTicket()){var btnTicket=new BtnTicket(game);group.add(btnTicket.element)}},proto.destroy=function(){this.group.destroy(),this.mask.hide(600)},Menu}),define("level/menu/BtnTicket",function(require){function BtnTicket(game){this.game=game,this.button=null,this.mask=null,this.ticket=null,this.element=null,this.init()}var util=require("common/util"),color=require("common/color"),Mask=require("common/ui/Mask"),Ticket=require("level/end/Ticket"),proto=BtnTicket.prototype;return proto.init=function(){var game=this.game,button=game.add.button(30,game.height-20,"button-ticket",this.onClick,this);button.scale.set(.7),button.anchor.set(0,1),this.button=button,util.addHover(button),this.element=button},proto.onClick=function(){var game=this.game;game.sound.play("click");var me=this,mask=new Mask(game,{alpha:.3,color:color.get("black"),onTouch:function(){me.hideTicket()}});mask.show(500),this.mask=mask;var ticket=new Ticket(game);ticket.element.fixedToCamera=!0,this.ticket=ticket,game.add.tween(ticket.element).from({alpha:0},500,Phaser.Easing.Quadratic.InOut).start()},proto.hideTicket=function(){this.mask.hide(500);var ticket=this.ticket,fadeOut=this.game.add.tween(ticket.element).to({alpha:0},500,Phaser.Easing.Quadratic.InOut);fadeOut.onComplete.add(function(){ticket.destroy()},this),fadeOut.start()},BtnTicket}),define("level/end/Ticket",function(require){function Ticket(game){this.game=game,this.image=null,this.element=null,this.init()}var color=require("common/color"),global=require("common/global"),proto=Ticket.prototype;return proto.init=function(){var game=this.game,ticket=game.add.image(game.width/2,130,"ticket");ticket.anchor.set(.5,0),ticket.scale.set(.64),this.image=ticket,this.element=ticket,require("common/datasource").getCode().then(function(res){res=JSON.parse(res);var codeText=res.success?(res.code+"").split("").join(" "):"奖券已领完",code=game.add.text(0,180,codeText,{font:"bold 60px "+global.fontFamily,fill:color.get("jujube")});code.anchor.set(.5,0),ticket.addChild(code),res.success&&!global.getTicket()&&global.setTicket(!0)})},proto.destroy=function(){this.element.destroy()},Ticket}),define("level/end/SuccessEnd",function(require){function SuccessEnd(game){End.call(this,game,{titleImageName:"success-title"}),this.init()}var global=require("common/global"),util=require("common/util"),End=require("./End"),Ticket=require("./Ticket");util.inherits(SuccessEnd,End);var proto=SuccessEnd.prototype;return proto.initContent=function(){var ticket=new Ticket(this.game);this.content.add(ticket.element)},proto.updateShare=function(){global.setShareText("【SSG运动会】我完成了挑战，你也来试试吧！")},SuccessEnd}),define("level/end/FailureEnd",function(require){function FailureEnd(game,options){End.call(this,game,{titleImageName:"failure-title"}),this.progress=options.progress,this.init()}var global=require("common/global"),color=require("common/color"),util=require("common/util"),End=require("./End");util.inherits(FailureEnd,End);var proto=FailureEnd.prototype;return proto.initContent=function(){var game=this.game,ring=game.add.image(game.width/2,120,"progress-ring");ring.anchor.set(.5,0);var progressText=game.add.text(10,121,Math.floor(100*this.progress)+"",{font:"48px "+global.fontFamily,fill:color.get("green")});progressText.anchor.set(1,0),ring.addChild(progressText),this.content.add(ring)},proto.updateShare=function(){global.setShareText("【SSG运动会】我完成了"+Math.floor(100*this.progress)+"%，你也来试试吧！")},FailureEnd}),define("level/end/End",function(require){function End(game,options){this.game=game,this.titleImageName=options.titleImageName,this.mask=null,this.group=null,this.content=null}var color=require("common/color"),Mask=require("common/ui/Mask"),BtnGroup=require("./BtnGroup"),proto=End.prototype;return proto.init=function(){var game=this.game,mask=new Mask(game,{alpha:.5,color:color.get("black")});mask.show(500),this.mask=mask;var title=game.add.image(game.width/2,37,this.titleImageName);title.anchor.set(.5,0),this.content=game.add.group(),this.initContent();var btnGroup=new BtnGroup(game),copyright=game.add.image(game.width-15,game.height-20,"copyright");copyright.anchor.set(1,1),copyright.scale.set(.55);var group=game.add.group();group.fixedToCamera=!0,group.addMultiple([title,this.content,btnGroup.group,copyright]),this.group=group,this.updateShare(),this.show()},proto.initContent=function(){},proto.updateShare=function(){},proto.show=function(){this.game.add.tween(this.group).from({alpha:0},500,Phaser.Easing.Quadratic.InOut).start()},End}),define("level/end/BtnGroup",function(require){function BtnGroup(game,options){this.game=game,this.group=null,this.init()}var color=require("common/color"),util=require("common/util"),Mask=require("common/ui/Mask"),proto=BtnGroup.prototype;return proto.init=function(){var game=this.game,me=this,group=game.add.group();group.x=game.width/2,group.y=game.height-50,this.group=group;var transition=function(){return new Mask(game,{color:color.get("black"),alpha:1}).show(150)},LEVEL_STATUS=game.state.states.level.STATUS,btnConfigList=[{name:"icon-back",scale:.7,onClick:function(){game.sound.play("click"),transition().then(function(){game.state.restart(!0,!1,LEVEL_STATUS.MENU)})}},{name:"icon-share",scale:.7,onClick:function(){game.sound.play("click")}},{name:"icon-restart",scale:.7,onClick:function(){game.sound.play("click"),transition().then(function(){game.state.restart(!0,!1,LEVEL_STATUS.PLAY)})}}],btnX=120*-(btnConfigList.length-1)/2;btnConfigList.forEach(function(config,index){var btn=game.add.button(btnX+120*index,0,config.name,config.onClick,me);btn.anchor.set(.5),btn.scale.set(config.scale?config.scale:1),util.addHover(btn),group.add(btn)})},proto.destroy=function(){this.group.destroy()},BtnGroup}),define("common/ui/Mask",function(require){function Mask(game,options){this.game=game,this.image=null,this.color=options.color||color.get("mask"),this.alpha=options.alpha||1,this.onTouch=options.onTouch||null,this.init()}var color=require("common/color");return Mask.prototype.init=function(){var game=this.game,bitmap=game.add.bitmapData(game.width,game.height);bitmap.rect(0,0,bitmap.width,bitmap.width,this.color);var image=game.add.image(0,0,bitmap);image.fixedToCamera=!0,image.alpha=this.alpha,image.inputEnabled=!0,this.image=image,this.onTouch&&this.bindTouch(this.onTouch)},Mask.prototype.show=function(duration){if(duration){var show=this.game.add.tween(this.image).from({alpha:0},duration,Phaser.Easing.Quadratic.InOut),promise=new Promise(function(resolve){show.onComplete.add(resolve)});return show.start(),promise}return Promise.resolve()},Mask.prototype.hide=function(duration){if(duration){var hide=this.game.add.tween(this.image).to({alpha:0},duration,Phaser.Easing.Quadratic.InOut),me=this,promise=new Promise(function(resolve){hide.onComplete.add(function(){this.destroy(),resolve()},me)});return hide.start(),promise}return this.image.alpha=0,this.destroy(),Promise.resolve()},Mask.prototype.bindTouch=function(onTouch){this.image.events.onInputUp.add(onTouch)},Mask.prototype.unbindTouch=function(){this.image.events.onInputUp.removeAll()},Mask.prototype.destroy=function(){var image=this.image;image.key.destroy(),image.destroy()},Mask}),define("level/level",function(require){function onInputDown(){this.isTouching=!0}function onInputUp(){this.isTouching=!1}var global=require("common/global"),util=require("common/util"),Zoom=require("common/Zoom"),Background=require("./scene/Background"),Menu=require("./menu/Menu"),Tutorial=require("./tutorial/Tutorial"),PlayUI=require("./play/PlayUI"),SuccessEnd=require("./end/SuccessEnd"),FailureEnd=require("./end/FailureEnd"),Terrain=require("./Terrain"),Hero=require("./Hero"),Power=require("./Power"),STATUS={MENU:0,PLAY:1,OVER:2},level={STATUS:STATUS};return level.init=function(status){this.reset(),this.status=status},level.reset=function(){util.extend(this,{background:null,midground:null,lightground:null,terrain:null,hero:null,zoom:null,power:null,menuUI:null,playUI:null,tutorial:null,successEnd:null,failureEnd:null,status:null,isTouching:!1,isPaused:!1,progress:0,lastCameraX:0})},level.preload=function(){this.time.advancedTiming=!0},level.create=function(){switch(this.world.height=720,this.status){case STATUS.MENU:this.initMenuStatus();break;case STATUS.PLAY:this.initPlayStatus()}},level.initMenuStatus=function(){this.initBaseObjects(),this.physics.box2d.pause();var game=this.game;this.menuUI=new Menu(game,{level:this})},level.initPlayStatus=function(){switch(this.status){case STATUS.MENU:this.menuUI.destroy(),this.status=STATUS.PLAY;break;case STATUS.PLAY:this.initBaseObjects()}this.physics.box2d.resume(),this.hero.wake(),this.bindTouch(),this.playUI=new PlayUI(this.game,{level:this}),this.lightground.show(1e3)},level.initBaseObjects=function(){this.initPhysics(),this.initViews();var game=this.game;this.power=new Power(game,{level:this}),this.terrain=new Terrain(game,{level:this}),this.hero=new Hero(game,{level:this}),this.initZoom()},level.initViews=function(){var game=this.game;this.background=new Background(game,{level:this,imageName:"light-ball",absSpeed:.2,relSpeed:.1}),this.midground=new Background(game,{level:this,imageName:"midground",absSpeed:0,relSpeed:.5}),this.lightground=new Background(game,{level:this,imageName:"light",absSpeed:4,relSpeed:1,alpha:0})},level.initPhysics=function(){var physics=this.physics;physics.startSystem(Phaser.Physics.BOX2D);var box2d=physics.box2d;box2d.density=1,box2d.friction=.03,box2d.restitution=.08,box2d.gravity.y=300},level.initZoom=function(){var zoom=new Zoom(this.game);zoom.addMultiple([this.hero.sprite]),this.zoom=zoom},level.bindTouch=function(){var input=this.input;input.onDown.add(onInputDown,this),input.onUp.add(onInputUp,this)},level.pause=function(){this.isPaused=!0,this.physics.box2d.pause(),this.pauseAnim()},level.pauseAnim=function(){this.terrain.pauseAnim(),this.hero.pauseAct()},level.resume=function(){this.isPaused=!1,this.physics.box2d.resume(),this.resumeAnim()},level.resumeAnim=function(){this.terrain.resumeAnim(),this.hero.resumeAct()},level.update=function(){switch(this.status){case STATUS.OVER:case STATUS.MENU:this.updateOnce(),this.updateView();break;case STATUS.PLAY:if(this.isPaused)return;this.updateOnce(),this.updateView(),this.updatePlay()}},level.updateOnce=function(){this.updateCamera(),this.power.update(),this.terrain.update(),this.hero.update()},level.updateCamera=function(){var game=this.game,hero=this.hero,heroSprite=hero.sprite,camera=this.camera,zoom=this.zoom,world=this.world,deadzone={x:100,y:100*zoom.scale.y},fullHeight=world.height-heroSprite.y+deadzone.y,scale=game.height<fullHeight?game.height/fullHeight:1;zoom.to(scale);var deltaWG=world.height-game.height;camera.y=heroSprite.y-deadzone.y>deltaWG?deltaWG:heroSprite.y-deadzone.y,camera.x=heroSprite.x*scale-deadzone.x},level.updateView=function(){this.background.update(),this.midground.update(),this.lightground.update(),this.lastCameraX=this.game.camera.x/this.zoom.scale.x},level.updatePlay=function(){var hero=this.hero;if(global.getNovice()&&hero.hasReachedMinVel){var game=this.game;game.time.events.add(300,function(){this.pause(),this.tutorial=new Tutorial(game,{level:this})},this),global.setNovice(!1)}var terrain=this.terrain,heroX=hero.getX();if(this.progress=heroX<terrain.distance?heroX/terrain.distance:1,this.playUI.update(),1===this.progress&&!hero.isAwake()&&!this.isOver())return void this.finish();var power=this.power,POWER_STATUS=power.STATUS;switch(power.status){case POWER_STATUS.EMPTY:hero.isAwake()||this.isOver()||this.fail()}},level.isOver=function(){return this.status===STATUS.OVER},level.finish=function(){this.complete(),this.sound.play("finish");var me=this,hero=this.hero;hero.goToTerminal(this.terrain).then(function(){hero.over(),me.game.time.events.add(500,function(){this.successEnd=new SuccessEnd(this.game)},me)})},level.fail=function(){this.complete(),this.sound.play("fall");var me=this,hero=this.hero;hero.fall(this.terrain).then(function(){hero.over(),me.game.time.events.add(500,function(){this.failureEnd=new FailureEnd(this.game,{progress:this.progress})},me)})},level.complete=function(){this.status=STATUS.OVER,this.physics.box2d.pause(),this.playUI.destroy(),this.lightground.hide(500)},level.render=function(){var game=this.game;game.debug.text("FPS: "+(game.time.fps||"--"),2,14,"#00ff00"),game.debug.box2dWorld()},level}),define("level/Terrain",function(require){function Terrain(game,options){this.game=game,this.level=options.level,this.extremums=[],this.body=null,this.edges=[],this.edgePoints=[],this.tubes=[],this.currents=[],this.logos=[],this.flag=null,this.hasFlag=!1,this.prevExtremumIndex=0,this.nextExtremumIndex=0,this.currentColor=color.get("electric"),this.cAlpha=1,this.cAlphaDeltaSign=-1,this.distance=null,this.init()}var color=require("common/color"),util=require("common/util"),proto=Terrain.prototype;return proto.init=function(){this.initExtremums(),this.initBody()},proto.initBody=function(){var game=this.game,body=new Phaser.Physics.Box2D.Body(game,null,0,0);body.static=!0,this.body=body},proto.initExtremums=function(){for(var game=this.game,worldHeight=game.world.height,extremums=[{x:-60,y:worldHeight-80},{x:100,y:worldHeight-160},{x:320,y:worldHeight-40},{x:600,y:worldHeight-200}],i=extremums.length;i<=108;++i){var bY,pointA=extremums[i-1],sign=i%2?-1:1;do{bY=pointA.y+sign*(80+game.rnd.between(0,110))}while(bY>worldHeight-30||bY<worldHeight-360);var pointB={x:pointA.x+200+game.rnd.between(0,120),y:bY};extremums.push(pointB)}var penult=extremums[108];extremums.push({x:penult.x+500,y:penult.y}),this.extremums=extremums,this.distance=penult.x,game.world.width=extremums[109].x},proto.update=function(){this.updateEdges(),this.updateCurrents(),this.updateFlag(),this.updateLogos()},proto.updateFlag=function(){if(!this.hasFlag){var game=this.game,boundsLeft=this.getPenult().x-600;game.camera.x/this.level.zoom.scale.x>boundsLeft&&this.initFlag()}},proto.initFlag=function(){var Flag=require("./scene/Flag"),game=this.game,penult=this.extremums[108];this.flag=new Flag(game,{x:game.world.width-70,y:penult.y}),this.hasFlag=!0},proto.pauseAnim=function(){this.hasFlag&&this.flag.pauseAnim()},proto.resumeAnim=function(){this.hasFlag&&this.flag.resumeAnim()},proto.getPenult=function(){return this.extremums[108]},proto.updateEdges=function(){this.clearPrevEdges(),this.drawNextEdges()},proto.updateCurrents=function(){this.updateCurrentColor(),this.renderCurrents()},proto.clearPrevEdges=function(){for(var game=this.game,body=this.body,extremums=this.extremums,edges=this.edges,currents=this.currents,tubes=this.tubes,logos=this.logos,zoom=this.level.zoom,removeEdge=function(edge){body.removeFixture(edge)},prevI=this.nextExtremumIndex;prevI>this.prevExtremumIndex;--prevI){var boundsLeft=game.camera.x/zoom.scale.x-400;if(extremums[prevI].x<boundsLeft){edges[prevI].forEach(removeEdge),edges[prevI]=null;var current=currents[prevI];current.key.destroy(),current.destroy(),currents[prevI]=null;var tube=tubes[prevI];tube.key.destroy(),tube.destroy(),tube[prevI]=null;var logo=logos[prevI];logo&&(logo.destroy(),logos[prevI]=null),this.prevExtremumIndex=prevI;break}}},proto.drawNextEdges=function(){for(var game=this.game,body=this.body,extremums=this.extremums,edges=this.edges,edgePoints=this.edgePoints,zoom=this.level.zoom,tubes=this.tubes,i=this.nextExtremumIndex;i<109;++i){var pointA=extremums[i],boundsRight=game.camera.x/zoom.scale.x+2e3;if(pointA.x>boundsRight)break;var pointB=extremums[i+1],segmentCount=Math.floor((pointB.x-pointA.x)/10),dx=(pointB.x-pointA.x)/segmentCount,da=Math.PI/segmentCount,ymid=(pointA.y+pointB.y)/2,ampl=(pointA.y-pointB.y)/2,p0={x:pointA.x,y:pointA.y},edgeGroup=[],bitmap=game.add.bitmapData(pointB.x-pointA.x,game.world.height),sprite=game.add.sprite(pointA.x,0,bitmap);sprite.terrainType="tube",tubes[i]=sprite,zoom.add(sprite);var points=[p0],ctx=bitmap.ctx;ctx.beginPath(),ctx.lineCap="round",ctx.lineWidth=2,ctx.strokeStyle=color.get("electric");for(var j=1;j<segmentCount+1;++j){var p1={x:pointA.x+j*dx,y:ymid+ampl*Math.cos(da*j)};points.push(p1),edgeGroup.push(body.addEdge(p0.x,p0.y,p1.x,p1.y));var p0xRel=p0.x-sprite.x,p1xRel=p1.x-sprite.x;ctx.moveTo(p0xRel,p0.y),ctx.lineTo(p1xRel,p1.y);var angle=Phaser.Math.angleBetween(p0xRel,p0.y,p1xRel,p1.y),cos=Math.cos(angle),sin=Math.sin(angle),iy=12*cos,ix=-12*sin;ctx.moveTo(p0xRel+ix,p0.y+iy),ctx.lineTo(p1xRel+ix,p1.y+iy),p0={x:p1.x,y:p1.y}}ctx.stroke(),ctx.closePath(),edgePoints[i]=points,edges.push(edgeGroup)}this.nextExtremumIndex!==i&&(this.nextExtremumIndex=i)},proto.updateCurrentColor=function(){var power=this.level.power,POWER_STATUS=power.STATUS;switch(power.status){case POWER_STATUS.STABLE:case POWER_STATUS.LOSING:this.currentColor=color.get("electric");break;case POWER_STATUS.NORMAL_CHARGE:this.currentColor=color.get("green");break;case POWER_STATUS.SUPER_CHARGE:this.currentColor=color.get("yellow")}},proto.renderCurrents=function(){var game=this.game,extremums=this.extremums,edgePoints=this.edgePoints,level=this.level,zoom=level.zoom,power=level.power,currents=this.currents;this.cAlpha>=1?this.cAlphaDeltaSign=-1:this.cAlpha<=.5&&(this.cAlphaDeltaSign=1),this.cAlpha+=.02*this.cAlphaDeltaSign;for(var extInd=this.prevExtremumIndex;extInd<this.nextExtremumIndex;++extInd){var pointA=extremums[extInd];if(pointA.x>game.camera.x/zoom.scale.x+power.value)break;var pointB=extremums[extInd+1],sprite=currents[extInd];if(!sprite){var bitmap=game.add.bitmapData(pointB.x-pointA.x,game.world.height);sprite=game.add.sprite(pointA.x,0,bitmap),sprite.terrainType="current",currents[extInd]=sprite,zoom.add(sprite)}this.drawCurrents(sprite,edgePoints[extInd])}},proto.drawCurrents=function(sprite,points){var game=this.game,bitmap=sprite.key,ctx=bitmap.ctx,level=this.level,zoom=level.zoom,power=level.power;sprite.alpha=this.cAlpha,bitmap.clear(),ctx.beginPath(),ctx.lineWidth=6,ctx.lineCap="round",ctx.strokeStyle=this.currentColor;for(var pointInd=1,len=points.length;pointInd<len;++pointInd){var p1=points[pointInd];if(p1.x>game.camera.x/zoom.scale.x+power.value)break;var p0=points[pointInd-1],angle=Phaser.Math.angleBetween(p0.x,p0.y,p1.x,p1.y),cos=Math.cos(angle),sin=Math.sin(angle),ix=-6*sin,iy=6*cos;ctx.moveTo(p0.x+ix-sprite.x,p0.y+iy),ctx.lineTo(p1.x+ix-sprite.x,p1.y+iy)}ctx.stroke(),ctx.closePath()},proto.updateLogos=function(){for(var extremums=this.extremums,logos=this.logos,extInd=this.prevExtremumIndex;extInd<=this.nextExtremumIndex;++extInd){var ext=extremums[extInd];void 0===logos[extInd]&&(extInd-3)%10==0&&109!==extInd&&this.addLogo(extInd,ext)}},proto.addLogo=function(extInd,ext){var game=this.game,sprite=game.add.image(ext.x,this.game.world.height-30,"baidu");sprite.anchor.set(.5,1),sprite.scale.set(.7),this.logos[extInd]=sprite,this.level.zoom.add(sprite)},proto.getTerminal=function(){var lastPoint=this.extremums[109];return{x:lastPoint.x-300,y:lastPoint.y}},proto.getNearestPoint=function(hero){for(var edgePoints=this.edgePoints,heroX=hero.body.x,extInd=this.prevExtremumIndex;extInd<=this.nextExtremumIndex;++extInd)for(var points=edgePoints[extInd],pointInd=0,pointsLen=points.length-1;pointInd<=pointsLen;++pointInd){var point=points[pointInd],distanceX=point.x-heroX;if(distanceX>=0&&distanceX<10)return util.extend({},point)}return null},Terrain}),define("level/Power",function(require){function Power(game,options){this.game=game,this.level=options.level,this.max=game.width,this.min=0,this.value=this.max,this.lossFreq=.5,this.normalCharge=.6,this.normalThreshold=game.world.height-440,this.superCharge=1.2,this.superThreshold=game.world.height-590,this.status=STATUS.LOSING,this.lastStatus=this.status,this.lowThreshold=150}var STATUS={EMPTY:0,STABLE:1,LOSING:2,NORMAL_CHARGE:3,SUPER_CHARGE:4},proto=Power.prototype;return proto.STATUS=STATUS,proto.update=function(){var newValue,level=this.level,hero=level.hero,heroBody=hero.body;if(this.lastStatus=this.status,level.status!==level.STATUS.PLAY||!hero.hasReachedMinVel)return void(this.status=STATUS.STABLE);heroBody.y<=this.superThreshold?(newValue=this.value+this.normalCharge,
this.value=newValue<this.max?newValue:this.max,this.status=STATUS.SUPER_CHARGE):heroBody.y<=this.normalThreshold?(newValue=this.value+this.superCharge,this.value=newValue<this.max?newValue:this.max,this.status=STATUS.NORMAL_CHARGE):(newValue=this.value-this.lossFreq,newValue>this.min?(this.value=newValue,this.status=STATUS.LOSING):(this.value=this.min,this.status=STATUS.EMPTY))},proto.isLow=function(){return this.value<this.lowThreshold},proto.render=function(){this.game.debug.text("power: "+this.value.toFixed(1),2,114,"yellow")},Power}),define("level/Hero",function(require){function Hero(game,options){this.game=game,this.level=options.level,this.sprite=null,this.body=null,this.light=null,this.radius=32,this.awake=!1,this.velocityCache=[],this.flyingFrameCount=0,this.isContactEnding=!1,this.isFlying=!1,this.hasReachedMinVel=!1,this.isDiving=!1,this.soundDive=null,this.init()}var proto=Hero.prototype;return proto.init=function(){this.initSprite(),this.initBody(),this.initLight(),this.sleep()},proto.initSprite=function(){var game=this.game,sprite=game.add.sprite(100,game.world.height-160-this.radius);sprite.scale.set(.6),sprite.anchor.set(.5),this.sprite=sprite},proto.initBody=function(){var game=this.game,sprite=this.sprite;game.physics.box2d.enable(sprite);var body=sprite.body;body.setCircle(this.radius),body.fixedRotation=!0,this.body=body,body.setBodyContactCallback(this.level.terrain,function(heroBody,terrainBody,heroFt,terrainFt,begin){this.isContactEnding=!begin},this)},proto.initLight=function(){var game=this.game,light=game.add.image(-60,-10,"light-fly");light.anchor.set(1,.5),light.alpha=0,this.light=light,this.sprite.addChild(light)},proto.showLight=function(){var game=this.game,light=this.light,Easing=Phaser.Easing,fadeIn=game.add.tween(light).to({alpha:1},50,Easing.Quadratic.Out),fadeOut=game.add.tween(light).to({alpha:0},300,Easing.Quadratic.In,!1,200);fadeIn.chain(fadeOut).start()},proto.act=function(action,fps,loop,refresh){var sprite=this.sprite,key=["hero",action].join("-");if((sprite.key!==key||refresh)&&(sprite.loadTexture(key),fps)){var animations=sprite.animations;!animations.getAnimation(action)&&animations.add(action,null,fps,!!loop),animations.play(action)}},proto.pauseAct=function(){this.sprite.animations.currentAnim.stop(),this.isDiving&&(this.soundDive.stop(),this.isDiving=!1)},proto.resumeAct=function(){this.sprite.animations.currentAnim.play()},proto.sleep=function(){this.act("sleep",5,!0)},proto.up=function(){this.act("up",6,!0)},proto.fly=function(){this.act("fly")},proto.down=function(){this.act("down")},proto.wake=function(){var game=this.game,timeEvents=game.time.events;timeEvents.add(200,function(){game.sound.play("wake"),this.act("wake",5)},this),timeEvents.add(1300,function(){this.body.applyForce(200,-200),this.awake=!0},this)},proto.dive=function(){var body=this.body;body.velocity.x>80&&body.applyForce(0,75),this.act("dive")},proto.shutdown=function(){this.act("over")},proto.over=function(){this.act("over",10,!1,!0)},proto.isAwake=function(){return this.awake},proto.getX=function(){return this.body.x},proto.update=function(){this.sprite.bringToTop(),this.awake&&(this.isContactEnding?++this.flyingFrameCount:(this.flyingFrameCount=0,this.isFlying=!1),this.updateStatus(),this.limitVelocity(),this.updateAngle())},proto.limitVelocity=function(){var body=this.body,velocity=body.velocity;velocity.x<80?this.hasReachedMinVel&&(velocity.x=80):(this.hasReachedMinVel=!0,velocity.x>1200&&(velocity.x=1200)),body.y<100&&velocity.y<0&&(velocity.y-=velocity.y/10)},proto.updateAngle=function(){var velocity=this.body.velocity,velocityCache=this.velocityCache;velocityCache.length>=10&&velocityCache.shift(),velocityCache.push({x:velocity.x,y:velocity.y});var sumVelocityX=0,sumVelocityY=0;velocityCache.forEach(function(vel){sumVelocityX+=vel.x,sumVelocityY+=vel.y});var cacheLength=velocityCache.length,avgVelocityX=sumVelocityX/cacheLength,avgVelocityY=sumVelocityY/cacheLength,pMath=Phaser.Math;this.body.angle=pMath.radToDeg(pMath.angleBetween(0,0,avgVelocityX,avgVelocityY))},proto.updateStatus=function(){var level=this.level;if(1===level.progress)return void(this.awake=!1);var power=level.power,POWER_STATUS=power.STATUS;switch(power.status){case POWER_STATUS.EMPTY:this.awake=!1;break;default:var body=this.body,angle=body.angle;if(level.isTouching)this.dive(),this.isDiving||(this.soundDive=level.sound.play("dive",1,!0),this.isDiving=!0);else if(this.isDiving&&(this.soundDive.stop(),this.isDiving=!1),angle<0)if(this.flyingFrameCount>=12){var velocity=body.velocity;if(!this.isFlying&&velocity.y<0){var speed=Math.sqrt(Math.pow(velocity.x,2)+Math.pow(velocity.y,2));speed>=550&&(level.sound.play("fly"),this.showLight(),speed>=800&&level.time.events.add(250,function(){level.sound.play("yell")}))}this.fly(),this.isFlying=!0}else this.up();else angle>0&&this.down()}},proto.goTo=function(position,duration,ease){var game=this.game,body=this.body,rotate=game.add.tween(body).to({angle:0},duration),move=game.add.tween(body).to(position,duration,ease),promise=new Promise(function(resolve){move.onComplete.add(resolve)});return rotate.start(),move.start(),promise},proto.goToTerminal=function(terrain){this.shutdown();var terminal=terrain.getTerminal();return terminal.y-=this.radius,this.goTo(terminal,400,Phaser.Easing.Linear.None)},proto.fall=function(terrain){this.shutdown();var position=terrain.getNearestPoint(this);position.y-=this.radius;var duration=Math.abs(this.body.y-position.y);return this.goTo(position,20*Math.sqrt(duration),Phaser.Easing.Quadratic.In)},proto.render=function(){var game=this.game,velocity=this.body.velocity;game.debug.text("vx: "+velocity.x.toFixed(2),2,34,"#fff"),game.debug.text("vy: "+velocity.y.toFixed(2),2,54,"#fff"),game.debug.text("speed: "+Math.sqrt(Math.pow(velocity.x,2)+Math.pow(velocity.y,2)).toFixed(0),2,134,"#fff")},Hero}),define("common/weixin",function(require){function init(){var signPackage=global.getSignPackage();signPackage.jsApiList=["onMenuShareTimeline","onMenuShareAppMessage"],wx.config(signPackage),wx.ready(function(){updateShare()})}function updateShare(){var link="http://farm.yiluwan.org/dupower/index.php",imgUrl="http://farm.yiluwan.org/dupower/asset/img/icon-200.png";wx.onMenuShareTimeline({title:global.shareText,link:link,imgUrl:imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:"Fighting SSGer",desc:global.shareText,link:link,imgUrl:imgUrl})}var global=require("common/global");return{init:init,updateShare:updateShare}}),define("common/util",function(require){var util={};return util.proba=function(p){p=10*p||1;var odds=Math.floor(10*Math.random());return 1===p||odds<p},util.inherits=function(type,superType){var Empty=function(){};Empty.prototype=superType.prototype;var proto=new Empty,originalPrototype=type.prototype;type.prototype=proto;for(var key in originalPrototype)proto[key]=originalPrototype[key];return type.prototype.constructor=type,type},util.extend=function(target,source){for(var i=1,len=arguments.length;i<len;i++)if(source=arguments[i])for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key]);return target},util.addHover=function(btn,target){var events=btn.events;target=target?target:btn;var originAlpha=target.alpha;events.onInputDown.add(function(){target.alpha=.8*originAlpha}),events.onInputUp.add(function(){target.alpha=originAlpha})},util.getWindowSize=function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}},util}),define("common/url",function(){var workSpace="http://farm.yiluwan.org/dupower/";return{LOAD_DATA:workSpace+"storage.php",SAVE_DATA:workSpace+"storage.php",GET_CODE:workSpace+"getcode.php"}}),define("common/global",function(require){var datasource=require("common/datasource"),MODE={DEV:0,PROD:1},global={mode:MODE.DEV,imgPath:null,audioPath:null,imgSuffix:null,signPackage:null,fontFamily:'"Helvetica Neue", Helvetica, STHeiTi, sans-serif',novice:null,ticket:null,shareText:null};return global.init=function(){this.initNovice(),this.initTicket(),this.resetShareText()},global.setDevMode=function(){this.mode=MODE.DEV,this.initResourceConfig()},global.setProdMode=function(){this.mode=MODE.PROD,this.initResourceConfig()},global.isDevMode=function(){return this.mode===MODE.DEV},global.isProdMode=function(){return this.mode===MODE.PROD},global.initResourceConfig=function(){this.isProdMode()?(this.imgPath="asset/img/",this.imgSuffix=".png",this.audioPath="asset/audio/"):(this.imgPath="http://ishowshao-game.qiniudn.com/du-power/asset/img/",this.imgSuffix=".png",this.audioPath="asset/audio/")},global.getSignPackage=function(){return this.signPackage},global.setSignPackage=function(obj){this.signPackage=obj},global.initNovice=function(){this.novice=!0},global.getNovice=function(){return this.novice},global.setNovice=function(novice){this.novice=novice},global.initTicket=function(){var me=this;datasource.load(["ticket"],function(res){res=JSON.parse(res),me.ticket=!!res.ticket&&JSON.parse(res.ticket)},function(err){me.ticket=!1})},global.getTicket=function(){return this.ticket},global.setTicket=function(ticket){this.ticket=ticket,datasource.save({ticket:ticket})},global.resetShareText=function(){this.shareText="【SSG运动会】Fighting SSGer!"},global.setShareText=function(text){this.shareText=text,global.isProdMode()&&require("common/weixin").updateShare()},global.init(),global}),define("common/datasource",function(){function load(keys,success,failure){ajax.get({url:url.LOAD_DATA,data:{key:keys.join(",")},success:success,failure:failure})}function save(data,success,failure){ajax.post({url:url.SAVE_DATA,data:data,success:success,failure:failure})}function getCode(success,failure){return get(url.GET_CODE)}function get(url,data){return new Promise(function(resolve){ajax.get({url:url,data:data,success:resolve,failure:function(err){resolve({success:!1})}})})}var ajax=require("common/ajax"),url=require("common/url");return{load:load,save:save,getCode:getCode}}),define("common/color",function(require){function get(color){return colors[color]}var colors={bg:"#0a0405",mask:"#7c7c7c",black:"#000",white:"#fff",electric:"#6ebdcb",red:"#d0394f",yellow:"#eec349",green:"#8dc662",jujube:"#6b3e3e"};return{get:get}}),define("common/ajax",function(require){function toQuery(data){var query=[];for(var key in data)data.hasOwnProperty(key)&&query.push(encodeURIComponent(key)+"="+encodeURIComponent(data[key]));return query.join("&")}function post(settings){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){4===xhr.readyState&&(200===xhr.status?settings.success&&settings.success(xhr.responseText,xhr):settings.failure&&settings.failure(xhr.status,xhr))},xhr.open("POST",settings.url?settings.url:""),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(this.toQuery(settings.data?settings.data:{}))}function get(settings){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){4===xhr.readyState&&(200===xhr.status?settings.success&&settings.success(xhr.responseText,xhr):settings.failure&&settings.failure(xhr.status,xhr))};var data=settings.data||{},url=settings.url||"";url+=url.indexOf("?")===-1?"?"+this.toQuery(data):"&"+this.toQuery(data),xhr.open("GET",url),xhr.send()}return{toQuery:toQuery,post:post,get:get}}),define("common/Zoom",function(require){function Zoom(game){Phaser.Group.call(this,game),this.bounds=Phaser.Rectangle.clone(game.world.bounds),this.scale.setTo(1)}var util=require("common/util");return util.inherits(Zoom,Phaser.Group),Zoom.prototype.to=function(scale,duration){var game=this.game,bounds=this.bounds,cameraBounds=game.camera.bounds,boundsTo={x:bounds.x*(1-scale)/2,y:bounds.y*(1-scale)/2,width:bounds.width*scale,height:bounds.height*scale};duration?(game.add.tween(cameraBounds).to(boundsTo,duration).start(),game.add.tween(this.scale).to({x:scale,y:scale},duration).start()):(util.extend(cameraBounds,boundsTo),this.scale.setTo(scale))},Zoom}),define("preload",function(require){var global=require("common/global"),color=require("common/color"),state={};return state.preload=function(){this.initLoading(),this.loadResources()},state.initLoading=function(){var game=this.game,offset=0;if(this.scale.isPortrait){game.add.text(game.width/2,120,"屏幕横过来才好玩哟",{font:"bold 46px "+global.fontFamily,fill:color.get("white")}).anchor.set(.5),offset=70}var hero=game.add.sprite(game.width/2,220+offset,"hero-sleep");hero.anchor.set(.5);hero.animations.add("sleep"),hero.animations.play("sleep",5,!0),game.add.text(game.width/2,330+offset,"SSGer 启动中...",{font:"bold 30px "+global.fontFamily,fill:color.get("electric")}).anchor.set(.5)},state.loadResources=function(){this.loadAudios(),this.loadImages()},state.loadImages=function(){var game=this.game,path=global.imgPath,suffix=global.imgSuffix;["hero","start","start-ring","title","title-decoration","button-ticket","icon-back","icon-share","icon-restart","success-title","ticket","failure-title","progress-ring","copyright","hero-label","button-pause","button-close","button-back","button-restart","charge","charge-double","light-fly","baidu","gesture","arrow-charge","arrow-current"].forEach(function(name){game.load.image(name,path+name+suffix)}),["hero-up","hero-fly","hero-down","hero-dive","hero-wake","hero-over"].forEach(function(name){game.load.spritesheet(name,path+name+suffix,120,212)}),game.load.spritesheet("midground",path+"midground"+suffix,800,272),game.load.spritesheet("light-ball",path+"light-ball"+suffix,1600,480),game.load.spritesheet("light",path+"light"+suffix,1400,720),game.load.spritesheet("flag",path+"flag"+suffix,186,197)},state.loadAudios=function(){var game=this.game;["bgm","click","wake","fly","yell","dive","charge","charge-double","finish","fall","alarm"].forEach(function(name){game.load.audio(name,[global.audioPath+name+".ogg",global.audioPath+name+".mp3"])})},state.create=function(){var game=this.game,bgm=game.add.audio("bgm");game.sound.setDecodedCallback([bgm],function(){bgm.loopFull()},this);var level=game.state.states.level;game.state.start("level",!0,!1,level.STATUS.MENU)},state}),define("main",function(require){function init(){global.isProdMode()&&require("common/weixin").init(),initGame()}function initGame(){var game=new Phaser.Game(800,480,Phaser.CANVAS,"");game.state.add("boot",require("boot")),game.state.add("preload",require("preload")),game.state.add("level",require("level/level")),game.state.start("boot")}var global=require("common/global");return{init:init}}),define("boot",function(require){function preload(){this.game.load.spritesheet("hero-sleep",global.imgPath+"hero-sleep"+global.imgSuffix,120,212)}function create(){var game=this.game;game.stage.backgroundColor=require("common/color").get("bg");var scale=this.scale;scale.pageAlignHorizontally=!0,scale.pageAlignVertically=!0,scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,setTimeout(function(){game.state.start("preload")},100)}var global=require("common/global");return{preload:preload,create:create}});